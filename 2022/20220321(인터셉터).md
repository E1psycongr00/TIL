# 20220321(ì¸í„°ì…‰í„°)

ìœ í˜•: SpringFramework
ì‘ì„±ì¼ì‹œ: 2022ë…„ 3ì›” 21ì¼ ì˜¤ì „ 11:11

# ì¸í„°ì…‰í„° ì…‹íŒ…í•˜ê¸°

ì¸í„°ì…‰í„°ëŠ” ë””ìŠ¤íŒ¨ì²˜ ì„œë¸”ë¦¿ê³¼ ì»¨íŠ¸ë¡¤ëŸ¬ ê°™ì— ì†Œí†µí•˜ëŠ” ì‚¬ì´ì— í•„í„°ì²˜ëŸ¼ ë¹„ìŠ·í•˜ê²Œ ë™ì‘í•œë‹¤.

ì…‹íŒ…í•˜ê¸° ìœ„í•´ì„œëŠ” 3ê°€ì§€ ê³¼ì •ì´ í•„ìš”í•˜ë‹¤.

1. í´ë˜ìŠ¤ ìƒì†ë°›ê¸°
2. ë¹ˆì„ ë“±ë¡í•˜ê¸°
3. ë§µí•‘í•˜ê¸°

<aside>
ğŸ’¡ í•„í„° : ë¸Œë¼ìš°ì € - ì„œë¸”ë¦¿ ì‚¬ì´ ë™ì‘

</aside>

<aside>
ğŸ’¡ ì¸í„°ì…‰í„°: ë””ìŠ¤íŒ¨ì²˜ - ì„œë¸”ë¦¿  ì‚¬ì´ì—ì„œ ë™ì‘

</aside>

## í´ë˜ìŠ¤ ìƒì†ë°›ê¸°

HandlerInterceptorAdapterì˜ í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì•„ì„œ Override í•´ì„œ ì‚¬ìš©í•œë‹¤. 4ê°œì˜ ë©”ì„œë“œë¥¼ override í•´ì„œ ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤.

1. preHandle: controller í˜¸ì¶œ ì´ì „ì— í˜¸ì¶œ
2. postHandle : controller í˜¸ì¶œ í›„ ë Œë”ë§ ì´ì „ì— ë™ì‘, ë·°ë‚˜ ëª¨ë¸ì„ ì¡°ì‘í•¨.
3. afterCompletion: ë Œë”ë§ í›„ì— ë™ì‘
4. afterConcurrentHandlingStarted

```java
public class MyHandlerInterceptor extends HandlerInterceptorAdapter {

	@Override
	public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler)
			throws Exception {
		System.out.println("preHandle");
		return true; // true : ëª¨ë“  ì¸í„°ì…‰í„° ì‹¤í–‰, false: interceptor skipí•˜ê³   Controller ë°”ë¡œ í˜¸ì¶œ
	}

	@Override
	public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler,
			ModelAndView modelAndView) throws Exception {
		System.out.println("postHandle");
	}

	@Override
	public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)
			throws Exception {
		System.out.println("afterCompletion");
	}
	
}
```

preHandleì—ì„œ ì¸í„°ì…‰í„°ê°€ ì‘ë™ í•  ë•Œ ë§Œì•½ return ê°’ì´ trueë©´ ëª¨ë“  ì¸í„°ì…‰í„°ë¥¼ ì‹¤í–‰í•œë‹¤. ê·¸ëŸ¬ë‚˜ falseë©´ ì¸í„°ì…‰í„°ë¥¼ skip í•˜ê³  controllerë¥¼ ë°”ë¡œ í˜¸ì¶œí•œë‹¤.

Object Handler ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ ê°ì²´ë¥¼ ì˜ë¯¸í•œë‹¤.

## ë¹ˆ ë“±ë¡í•˜ê¸°

### ì§ì ‘ ë“±ë¡í•˜ê¸°

```xml
<!--  ë¹ˆ ë“±ë¡ -->
<bean id="interceptor" class="com.interceptor.MyHandlerInterceptor"/>
<bean id="testcontroller" class="com.controller.TestController"/>
<bean id="hellocontroller" class="com.controller.HelloController"/>
```

### ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” í™œìš©í•˜ê¸°

@Componenet(â€idâ€)ë¥¼ ë„£ì–´ì£¼ê³  ê·¸ id ê°’ìœ¼ë¡œ ë§¤í•‘í•´ì£¼ë©´ ëœë‹¤.

ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” íƒœê·¸ë„ ë„£ì–´ ì£¼ì–´ì•¼ í•œë‹¤.

## ë§µí•‘í•˜ê¸°

```xml
<!--  Interceptor ë§µí•‘ -->
	<mvc:interceptors>
		<mvc:interceptor>
			<mvc:mapping path="/main"/>
			<ref bean="interceptor"/>
		</mvc:interceptor>
	</mvc:interceptors>
```

ì¸í„°ì…‰í„°ë¥¼ ë§¤í•‘í•´ì¤˜ì•¼ ì‹¤ì œë¡œ í˜¸ì¶œ í•  ìˆ˜ ìˆë‹¤.

ìš°ì„  mvc ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ë“±ë¡í•˜ê³   interceptors ì•ˆì— ì›í•˜ëŠ” interceoptor íƒœê·¸ë¥¼ ì—¬ëŸ¬ê°œ ì •ì˜ í•´ ì¤„ ìˆ˜ ìˆë‹¤. ì¸í„°ì…‰í„° íƒœê·¸ ì•ˆì— í˜¸ì¶œ í•  pathì™€ ë“±ë¡í•œ ë¹ˆì„ ì£¼ì…í•œë‹¤.

# ì¸í„°ì…‰í„° í™œìš©

## preHandleì„ ì‚¬ìš©í•œ ë¡œê·¸ì¸ ì²˜ë¦¬

TestController

```java
@Controller
public class TestController {
	
	// requestMethod.get ==> getë°©ì‹ìœ¼ë¡œ ìš”ì²­í•˜ê² ë‹¤.
	@RequestMapping(value="/login", method=RequestMethod.GET)
	public String list() {
		System.out.println("");
		return "loginForm";
	}
	
	@RequestMapping(value="/login", method=RequestMethod.POST)
	public String login(LoginDTO dto, HttpSession session) {
		
		// ìœ íš¨ì„± ì²´í¬
		
		session.setAttribute("login", dto);
		return "login"; // 
	}
	
	// requestMethod.get ==> getë°©ì‹ìœ¼ë¡œ ìš”ì²­í•˜ê² ë‹¤.
		@RequestMapping(value="/logout", method=RequestMethod.GET)
		public String logout(HttpSession session) {
			session.invalidate();
			return "loginForm";
		}
	
	@RequestMapping(value="/cart/list", method=RequestMethod.GET)
	public String cartList(LoginDTO dto, HttpSession session) {
		
		// ìœ íš¨ì„± ì²´í¬
		
		session.setAttribute("login", dto);
		return "cart"; // 
	}
	
	@RequestMapping(value="/cart/add", method=RequestMethod.GET)
	public String cartAdd(LoginDTO dto, HttpSession session) {
		
		// ìœ íš¨ì„± ì²´í¬
		
		session.setAttribute("login", dto);
		return "cart"; // 
	}
}
```

 ì¥ë°”êµ¬ë‹ˆë‚˜ ê°œì¸ ì •ë³´ê´€ë ¨ì€ ë¡œê·¸ì¸ ë˜ì–´ ìˆì§€ ì•Šìœ¼ë©´ ë“¤ì–´ ê°€ë©´ ì•ˆë˜ê±°ë‚˜... ì•„ë¬´ê²ƒë„ ë¡œë“œí•˜ë©´ ì•ˆëœë‹¤. ë§Œì•½ ë“¤ì–´ ê°ˆ ìˆ˜ ì—†ê²Œ ì„¤ê³„í•œë‹¤ê³  ê°€ì •í•˜ë©´ ë¡œê·¸ì¸ì´ ë˜ì§€ ì•Šìœ¼ë©´ ë¡œê·¸ì¸ì´ ë˜ë„ë¡ ì²˜ë¦¬ í•˜ë©´ ì¢‹ì„ ê²ƒì´ë‹¤. ë§Œì•½ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë¶„ê¸°ì¡°ê±´ì„ í™œìš©í•´ì„œ ì„¤ê³„í•œë‹¤ë©´ ì¡°ê¸ˆ ë³µì¡í•´ ì§ˆ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì´ ë•Œ ì¸í„°ì…‰í„°ì˜ preHandleì„ í™œìš©í•˜ë©´ ì‰½ê²Œ ì„¤ê³„ í•  ìˆ˜ ìˆë‹¤.

ì¸í„°ì…‰í„°ì˜ preHandle ë©”ì„œë“œì˜ í˜¸ì¶œ ì‹œì ì€ ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì´ì „ì´ë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ë¡œê·¸ì¸ í•´ì•¼ì§€ë§Œ ì ‘ê·¼ í•  ìˆ˜ ìˆëŠ” ìš”ì²­ ë§µí•‘ì´ ë“¤ì–´ ì˜¬ ë•Œ ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¼ í†µê³¼ ì‹œí‚¤ê±°ë‚˜ ì•„ë‹ˆë©´ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì‹œí‚¬ ìˆ˜ ìˆë‹¤.  ë°‘ì˜ ì½”ë“œëŠ” ë¡œê·¸ì¸ ì²˜ë¦¬ ê´€ë ¨ ì¸í„°ì…‰í„° í´ë˜ìŠ¤ì˜ ì˜ˆì œì´ë‹¤.

```java
@Component("interceptor")
public class MyHandlerInterceptor extends HandlerInterceptorAdapter {

	@Override
	public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler)
			throws Exception {
		
		// prehandle ëŒ€í‘œì‘ì—… : ë¡œê·¸ì¸ ì²˜ë¦¬
		/*
		 * ë¡œê·¸ì¸ ì²˜ë¦¬
		 */
		HttpSession session = request.getSession();
		LoginDTO dto = (LoginDTO)session.getAttribute("login");
		if(dto == null) {
			response.sendRedirect("/app/login");
		}
		
		return true; // true : ëª¨ë“  ì¸í„°ì…‰í„° ì‹¤í–‰, false: interceptor skipí•˜ê³   Controller ë°”ë¡œ í˜¸ì¶œ
	}
}
```

## postHandleì„ ì‚¬ìš©í•œ ë·°, ëª¨ë¸ ì²˜ë¦¬

```java
@Override
	public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler,
			ModelAndView modelAndView) throws Exception {
		// ëª¨ë¸ ë° ë·° ì •ë³´ë¥¼ ë³€ê²½ í•˜ëŠ” ì‘ì—…
		
		System.out.println(modelAndView.getViewName());
		//TestController ì¸ ê²½ìš°  index.jsp ==>  info.jsp ë³€ê²½

	}
```

ModelAndView ì •ë³´ë¥¼ ê°€ì ¸ ì˜¬ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ëª¨ë¸ì„ ì¶”ê°€í•˜ê±°ë‚˜ ì¡°ì‘ í•  ìˆ˜ ìˆê³  view ë˜í•œ ì¡°ì‘ ê°€ëŠ¥í•˜ë‹¤.